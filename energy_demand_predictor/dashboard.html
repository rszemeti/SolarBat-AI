<!DOCTYPE html>
<html>
<head>
    <title>SolarBat-AI Battery Optimizer</title>
    <meta http-equiv="refresh" content="60">
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }
        .info {
            text-align: center;
            margin-bottom: 20px;
            color: #00ff00;
        }
        .stats {
            background: #0a0a0a;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid #003300;
            border-radius: 5px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        .stat-item {
            padding: 10px;
            background: #001a00;
            border-radius: 3px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #0a0a0a;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        th, td {
            padding: 8px;
            text-align: center;
            border: 1px solid #003300;
            font-size: 11px;
        }
        th {
            background: #001a00;
            color: #00ff00;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        tr:hover {
            background: #002200;
        }
        .charge {
            color: #00ffff;
        }
        .discharge {
            color: #ff8800;
        }
        .hold {
            color: #888888;
        }
        .export {
            color: #00ff00;
        }
        .arrow-up {
            color: #00ff00;
        }
        .arrow-down {
            color: #ff0000;
        }
        .cost-positive {
            color: #ff0000;
        }
        .cost-negative {
            color: #00ff00;
        }
        .solar {
            color: #ffaa00;
        }
        .current-slot {
            background: #003300 !important;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ SolarBat-AI Battery Optimizer âš¡</h1>
        <div class="info">
            Last Update: {{ last_update }}<br>
            Optimizer: {{ optimizer_name }}<br>
            Auto-refresh every 60 seconds
        </div>
        
        {% if stats %}
        <div class="stats">
            <h3 style="margin-top: 0;">ðŸ“Š Optimization Summary</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <strong>Total Cost (48h):</strong><br>
                    Â£{{ "%.2f"|format(stats.total_cost) }}
                </div>
                <div class="stat-item">
                    <strong>Grid Charging:</strong><br>
                    {{ stats.charge_from_grid_slots }} slots
                </div>
                <div class="stat-item">
                    <strong>Solar Charging:</strong><br>
                    {{ stats.charge_from_solar_slots }} slots
                </div>
                <div class="stat-item">
                    <strong>Home Discharge:</strong><br>
                    {{ stats.discharge_to_home_slots }} slots
                </div>
                <div class="stat-item">
                    <strong>Grid Export:</strong><br>
                    {{ stats.discharge_to_grid_slots }} slots
                </div>
                <div class="stat-item">
                    <strong>Hold:</strong><br>
                    {{ stats.hold_slots }} slots
                </div>
            </div>
        </div>
        {% endif %}
        
        <table>
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Import p</th>
                    <th>Export p</th>
                    <th>State</th>
                    <th>Bat. kW</th>
                    <th>Grid kW</th>
                    <th>PV kW</th>
                    <th>Load kW</th>
                    <th>SoC %</th>
                    <th>Cost p</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for slot in schedule %}
                <tr class="{{ 'current-slot' if slot.is_current else '' }}">
                    <td>{{ slot.time }}</td>
                    <td>{{ "%.2f"|format(slot.import_rate) }}</td>
                    <td>{{ "%.2f"|format(slot.export_rate) }}</td>
                    <td class="{{ slot.action }}">
                        {% if slot.action == 'charge' %}
                        Chrg<span class="arrow-up">â†—</span>
                        {% elif slot.action == 'discharge' %}
                        <span class="arrow-down">â†˜</span>
                        {% else %}
                        âšŠ
                        {% endif %}
                    </td>
                    <td>{{ "%.1f"|format(slot.power) }}</td>
                    <td>
                        {% set grid_net = slot.grid_import - slot.grid_export %}
                        {% if grid_net > 0.01 %}
                        <span class="cost-positive">{{ "%.1f"|format(grid_net) }}â†“</span>
                        {% elif grid_net < -0.01 %}
                        <span class="cost-negative">{{ "%.1f"|format(-grid_net) }}â†‘</span>
                        {% else %}
                        âšŠ
                        {% endif %}
                    </td>
                    <td class="solar">
                        {% if slot.solar > 0 %}
                        {{ "%.2f"|format(slot.solar) }}â˜€
                        {% else %}
                        âšŠ
                        {% endif %}
                    </td>
                    <td>{{ "%.2f"|format(slot.demand) }}</td>
                    <td>
                        {{ slot.soc_percent }}
                        {% if slot.soc_change > 0 %}
                        <span class="arrow-up">â†—{{ slot.soc_change }}</span>
                        {% elif slot.soc_change < 0 %}
                        <span class="arrow-down">â†˜{{ slot.soc_change }}</span>
                        {% else %}
                        â†’
                        {% endif %}
                    </td>
                    <td class="{{ 'cost-positive' if slot.cost > 0 else 'cost-negative' }}">
                        {{ "%.0f"|format(slot.cost * 100) }}
                    </td>
                    <td class="{{ 'cost-positive' if slot.total_cost > 0 else 'cost-negative' }}">
                        <span class="{{ 'arrow-down' if slot.cost_trend == 'down' else 'arrow-up' if slot.cost_trend == 'up' else '' }}">
                            {{ 'â†˜' if slot.cost_trend == 'down' else 'â†—' if slot.cost_trend == 'up' else 'â†’' }}
                        </span>
                        Â£{{ "%.2f"|format(slot.total_cost) }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <div class="info" style="margin-top: 20px;">
            <strong>Legend:</strong> 
            <span class="charge">Chrgâ†— = Charging</span> | 
            <span class="discharge">â†˜ = Discharging</span> | 
            <span class="hold">âšŠ = Hold</span> | 
            <span class="solar">â˜€ = Solar</span> | 
            <span class="cost-positive">Gridâ†“ = Importing</span> | 
            <span class="cost-negative">Gridâ†‘ = Exporting</span>
        </div>
    </div>
</body>
</html>